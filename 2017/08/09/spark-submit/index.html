<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><meta name="description" content="Blog post"><title>Untitled</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_title_.8kzbYMPX.css"><script type="module">const e=()=>{document.querySelectorAll(".animate").forEach((t,s)=>{setTimeout(()=>{t.classList.add("show")},s*150)})};e();document.addEventListener("astro:after-swap",e);
</script></head> <body> <header> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex flex-wrap gap-y-2 justify-between"> <a href="/" class="font-semibold hover:underline underline-offset-2">
Blog
</a> <nav class="flex gap-1">  <a href="/archive" class="hover:underline underline-offset-2"> Archive </a> <span>/</span> <a href="/about" class="hover:underline underline-offset-2"> About </a>  </nav> </div>  </div> </header> <main>  <div class="mx-auto max-w-screen-sm px-5">  <div class="animate"> <a href="/archive" class="hover:underline underline-offset-2">
← Back to archive
</a> </div> <div class="space-y-1 my-10"> <div class="animate flex items-center gap-1.5"> <div class="font-base text-sm"> <time datetime="2017-08-09T00:00:00.000Z"> August 9, 2017 </time> </div> </div> <div class="animate text-2xl font-semibold text-black dark:text-white">  </div>  </div> <article class="animate"> <h2 id="title-spark-submit-参数分析date-2017-08-09-075400categories-sparktags-spark">title: Spark Submit 参数分析
date: 2017-08-09 07:54:00
categories: spark
tags: [spark]</h2>
<p><a href="https://spoddutur.github.io/spark-notes/distribution_of_executors_cores_and_memory_for_spark_application?utm_campaign=CodeTengu&#x26;utm_medium=email&#x26;utm_source=CodeTengu_99">Ever wondered how to configure —num-executors, —executor-memory and —execuor-cores spark config params for your cluster?</a></p>
<ul>
<li>
<p>Lil bit theory: Let’s see some key recommendations that will help understand it better</p>
</li>
<li>
<p>Hands on: Next, we’ll take an example cluster and come up with recommended numbers to these spark params</p>
</li>
</ul>
<p>Lil bit theory:</p>
<ul>
<li>Hadoop/Yarn/OS Deamons:</li>
</ul>
<p>serveral daemons that’ll run in the background like NameNode, Secondary NameNode, DataNode, JobTracker and TaskTracker</p>
<p>num-executors, we need to make sure that we leave aside enough cores (~1 core per node)</p>
<ul>
<li>Yarn ApplicationMaster (AM)</li>
</ul>
<p>If we are running spark on yarn, then we need to budget in the resources that AM would need (~1024MB and 1 Executor)</p>
<ul>
<li>
<p>HDFS Throughput</p>
</li>
<li>
<p>MemoryOverhead</p>
</li>
</ul>
<blockquote>
<p>Full memory requested to yarn per executor =<code>spark-executor-memory + spark.yarn.executor.memoryOverhead</code></p>
</blockquote>
<blockquote>
<p>spark.yarn.executor.memoryOverhead = <code>Max(384MB, 7% of spark.executor-memory)</code></p>
</blockquote>
<p>So, if we request 20GB per executor, AM will actually get 20GB + memoryOverhead = 20 + 7% of 20GB = ~23GB memory for us.</p>
<p>tips:</p>
<p>Running tiny executors (with a single core and just enough memory needed to run a single task, for example) throws away the benefits that come from running multiple tasks in a single JVM.</p>
<p>相关的配置:</p>
<blockquote>
<p><strong>Cluster Config:</strong>
10 Nodes
16 cores per Node
64GB RAM per Node</p>
</blockquote>
<ul>
<li>First Approach: Tiny executors [One Executor per core]:</li>
</ul>
<blockquote>
<ul>
<li><code>--num-executors</code> = <code>In this approach, we'll assign one executor per core</code></li>
</ul>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">total-cores-in-cluster</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">num-cores-per-node</span><span style="color:#79B8FF"> *</span><span style="color:#9ECBFF"> total-nodes-in-cluster`</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#79B8FF"> 16</span><span style="color:#9ECBFF"> x</span><span style="color:#79B8FF"> 10</span><span style="color:#9ECBFF"> =</span><span style="color:#79B8FF"> 160</span></span>
<span class="line"></span></code></pre>
<ul>
<li><code>--executor-cores</code> = 1 (one executor per core)</li>
<li><code>--executor-memory</code> = <code>amount of memory per executor</code>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">mem-per-node/num-executors-per-node</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> 64GB/16</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> 4GB</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
<p>Not Good!</p>
<ul>
<li>Second Approach: Fat executors (One Executor per node):</li>
</ul>
<blockquote>
<ul>
<li><code>--num-executors</code> = <code>In this approach, we'll assign one executor per node</code></li>
</ul>
</blockquote>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">total-nodes-in-cluster</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"></span></code></pre>
<ul>
<li>
<p><code>--executor-cores</code> = <code>one executor per node means all the cores of the node are assigned to one executor</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">total-cores-in-a-node</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#79B8FF"> 16</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p><code>--executor-memory</code> = <code>amount of memory per executor</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> `</span><span style="color:#B392F0">mem-per-node/num-executors-per-node</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">=</span><span style="color:#9ECBFF"> 64GB/1</span><span style="color:#9ECBFF"> =</span><span style="color:#9ECBFF"> 64GB</span></span>
<span class="line"></span></code></pre>
<p>​<br>
Not Good for HDFS throughput</p>
</li>
</ul>
<ul>
<li>
<p>Third Approach: Balance between Fat (vs) Tiny</p>
<ul>
<li>Based on the recommendations mentioned above, Let’s assign 5 core per executors => —executor-cores = 5 (for good HDFS throughput)</li>
<li>Leave 1 core per node for Hadoop/Yarn daemons => Num cores available per node = 16-1 = 15</li>
<li>So, Total available of cores in cluster = 15 x 10 = 150</li>
<li>Number of available executors = (total cores/num-cores-per-executor) = 150/5 = 30</li>
<li>Leaving 1 executor for ApplicationManager => —num-executors = 29</li>
<li>Number of executors per node = 30/10 = 3</li>
<li>Memory per executor = 64GB/3 = 21GB</li>
<li>Counting off heap overhead = 7% of 21GB = 3GB. So, actual —executor-memory = 21 - 3 = 18GB</li>
</ul>
</li>
</ul>
<p>recommended config is: 29 executors, 18GB memory each and 5 cores each!!</p> </article>  </div>  </main> <footer class="animate" data-astro-cid-sz7xmlte> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex justify-between items-center" data-astro-cid-sz7xmlte> <div data-astro-cid-sz7xmlte>
&copy; 2026 | Blog
</div> <div class="flex flex-wrap gap-1 items-center" data-astro-cid-sz7xmlte> <button id="light-theme-button" aria-label="Light theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <circle cx="12" cy="12" r="5" data-astro-cid-sz7xmlte></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-sz7xmlte></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-sz7xmlte></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-sz7xmlte></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-sz7xmlte></line> </svg> </button> <button id="dark-theme-button" aria-label="Dark theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-sz7xmlte></path> </svg> </button> <button id="system-theme-button" aria-label="System theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <rect x="2" y="3" width="20" height="14" rx="2" ry="2" data-astro-cid-sz7xmlte></rect> <line x1="8" y1="21" x2="16" y2="21" data-astro-cid-sz7xmlte></line> <line x1="12" y1="17" x2="12" y2="21" data-astro-cid-sz7xmlte></line> </svg> </button> </div> </div>  </div> </footer>  <script>
  function setTheme(theme) {
    document.documentElement.classList.remove("light", "dark", "system");
    
    if (theme === "system") {
      document.documentElement.classList.add("system");
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      document.documentElement.classList.add(systemTheme);
    } else {
      document.documentElement.classList.add(theme);
    }
    
    localStorage.setItem("theme", theme);
  }

  document.getElementById("light-theme-button")?.addEventListener("click", () => setTheme("light"));
  document.getElementById("dark-theme-button")?.addEventListener("click", () => setTheme("dark"));
  document.getElementById("system-theme-button")?.addEventListener("click", () => setTheme("system"));

  const savedTheme = localStorage.getItem("theme") || "system";
  setTheme(savedTheme);
</script>  </body> </html>