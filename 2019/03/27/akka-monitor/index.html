<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><meta name="description" content="Blog post"><title>Untitled</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_title_.U5p-WJ3X.css"><script type="module">const e=()=>{document.querySelectorAll(".animate").forEach((t,s)=>{setTimeout(()=>{t.classList.add("show")},s*150)})};e();document.addEventListener("astro:after-swap",e);
</script></head> <body> <header> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex flex-wrap gap-y-2 justify-between"> <a href="/" class="font-semibold hover:underline underline-offset-2">
Blog
</a> <nav class="flex gap-1">  <a href="/archive" class="hover:underline underline-offset-2"> Archive </a> <span>/</span> <a href="/tags" class="hover:underline underline-offset-2"> Tags </a> <span>/</span> <a href="/categories" class="hover:underline underline-offset-2"> Categories </a> <span>/</span> <a href="/about" class="hover:underline underline-offset-2"> About </a>  </nav> </div>  </div> </header> <main>  <div class="mx-auto max-w-screen-sm px-5">  <div class="animate"> <a href="/archive" class="hover:underline underline-offset-2">
← Back to archive
</a> </div> <div class="space-y-1 my-10"> <div class="animate flex items-center gap-1.5"> <div class="font-base text-sm"> <time datetime="2019-03-27T00:00:00.000Z"> March 27, 2019 </time> </div> </div> <div class="animate text-2xl font-semibold text-black dark:text-white">  </div>  </div> <article class="animate"> <h2 id="title--akka-monitordate--2019-03-27-105228categories--akkatags--akka">title : Akka Monitor
date : 2019-03-27 10:52:28
categories : akka
tags : [akka]</h2>
<p><a href="https://cloud.tencent.com/developer/article/1014163">原文链接</a></p>
<p>对比起我们习惯的行令式（imperative）编程模式，Actor编程模式更接近现实中的应用场景和功能测试模式。这是因为Actor是靠消息来驱动的，每种消息代表一项功能的运算指令</p>
<p>由于每个Actor的运算都在自己独立的线程里进行，所以我们不必担心Actor函数在运行中的交叉调用问题。Akka程序本就是一种原生的多线程程序，每个Actor都在一个自己的线程内独立运算它的receive函数</p>
<p>关于actor自有线程的实现？</p>
<p>在Akka编程里我们可以把每段可能产生异常的代码放到一个独立的Actor中去运算</p>
<p>父级Actor对发生异常的子级Actor有以下几种处理方式：</p>
<p>1、恢复运算（Resume）：不必理会异常，保留当前状态，跳过当前异常消息，照常继续处理其它消息</p>
<p>2、重新启动（Restart）：清除当前状态，保留邮箱及内容，终止当前Actor，再重新构建一个新的Actor实例，沿用原来的消息地址ActorRef继续工作</p>
<p>3、彻底终止（Stop）：销毁当前Actor及ActorRef邮箱，把所有消息导向DeadLetter队列。</p>
<p>4、向上提交（Esculate）：如果父级无法处理子级异常，则这种情况也视为父级出现的异常。按照规定，父级会将自己和子级Actor运算暂停挂起并把子级Actor实际产生的异常当作自己发生的异常提交给上一层父级处理（也就是说异常信息的发送者sender变成了父级Actor）</p>
<p>Akka处理异常的方式简单直接：如果发生异常就先暂停挂起然后交给直属父级Actor去处理。这就把异常封闭在这个Actor的监管链条里。Akka系统的监管链条实际代表一个功能的分散封闭运算，所以一个监管链条里发生的异常不会影响其它监管链条。换句话说就是Actor发生异常是封闭在它所属的功能内部的，一个功能发生异常不会影响其它功能。</p>
<p>Akka提供了OneForOneStrategy和AllForOneStrategy两种对待异常Actor的策略配置</p>
<ul>
<li>
<p>OneForOneStrategy：只针对发生异常的Actor施用策略</p>
</li>
<li>
<p>AllForOneStrategy：虽然一个直属子级Actor发生了异常，监管父级Actor把它当作所有下属子级同时发生了相同异常，对所有子级Actor施用策略</p>
</li>
</ul>
<p>生命周期</p>
<p>preStart</p>
<p>preStop</p>
<p>Akka提供了一种逐步延时重启策略（BackoffSupervisor）</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">val</span><span style="color:#FFAB70"> childProps</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> Props</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">classOf</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">EchoActor</span><span style="color:#E1E4E8">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">val</span><span style="color:#FFAB70"> supervisor</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> BackoffSupervisor</span><span style="color:#E1E4E8">.props(</span></span>
<span class="line"><span style="color:#B392F0">  Backoff</span><span style="color:#E1E4E8">.onFailure(</span></span>
<span class="line"><span style="color:#E1E4E8">    childProps,</span></span>
<span class="line"><span style="color:#E1E4E8">    childName </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "myEcho"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    minBackoff </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">.seconds,</span></span>
<span class="line"><span style="color:#E1E4E8">    maxBackoff </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 30</span><span style="color:#E1E4E8">.seconds,</span></span>
<span class="line"><span style="color:#E1E4E8">    randomFactor </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.2</span><span style="color:#6A737D"> // adds 20% "noise" to vary the intervals slightly</span></span>
<span class="line"><span style="color:#E1E4E8">  ).withManualReset</span></span>
<span class="line"><span style="color:#E1E4E8">  .withSupervisorStrategy(</span></span>
<span class="line"><span style="color:#B392F0">    OneforOneStrategy</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> _</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">GivingUpException</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> Stop</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> _</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">RetryableException</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> Restart</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> _</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">MinorException</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> Resume</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  )</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#E1E4E8">system.actorOf(supervisor, name </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "echoSupervisor"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Akka提供了context.watch和context.unwatch来设置通过ActorRef对任何Actor的终止状态监视，无须父子级别关系要求。但是还是要求当前为actor？</p>
<p>生命周期监控函数中只有postStop被调用过，preRestart和postRestart都没引用。如果这样的话BackoffSupervisor就是一锤子买卖，是正真的let it crash模式体现了。</p> </article>  </div>  </main> <footer class="animate" data-astro-cid-sz7xmlte> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex justify-between items-center" data-astro-cid-sz7xmlte> <div data-astro-cid-sz7xmlte>
&copy; 2026 | Blog
</div> <div class="flex flex-wrap gap-1 items-center" data-astro-cid-sz7xmlte> <button id="light-theme-button" aria-label="Light theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <circle cx="12" cy="12" r="5" data-astro-cid-sz7xmlte></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-sz7xmlte></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-sz7xmlte></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-sz7xmlte></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-sz7xmlte></line> </svg> </button> <button id="dark-theme-button" aria-label="Dark theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-sz7xmlte></path> </svg> </button> <button id="system-theme-button" aria-label="System theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <rect x="2" y="3" width="20" height="14" rx="2" ry="2" data-astro-cid-sz7xmlte></rect> <line x1="8" y1="21" x2="16" y2="21" data-astro-cid-sz7xmlte></line> <line x1="12" y1="17" x2="12" y2="21" data-astro-cid-sz7xmlte></line> </svg> </button> </div> </div>  </div> </footer>  <script>
  function setTheme(theme) {
    document.documentElement.classList.remove("light", "dark", "system");
    
    if (theme === "system") {
      document.documentElement.classList.add("system");
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      document.documentElement.classList.add(systemTheme);
    } else {
      document.documentElement.classList.add(theme);
    }
    
    localStorage.setItem("theme", theme);
  }

  document.getElementById("light-theme-button")?.addEventListener("click", () => setTheme("light"));
  document.getElementById("dark-theme-button")?.addEventListener("click", () => setTheme("dark"));
  document.getElementById("system-theme-button")?.addEventListener("click", () => setTheme("system"));

  const savedTheme = localStorage.getItem("theme") || "system";
  setTheme(savedTheme);
</script>  </body> </html>