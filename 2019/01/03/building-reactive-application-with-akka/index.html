<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><meta name="description" content="Blog post"><title>Untitled</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_title_.U5p-WJ3X.css"><script type="module">const e=()=>{document.querySelectorAll(".animate").forEach((t,s)=>{setTimeout(()=>{t.classList.add("show")},s*150)})};e();document.addEventListener("astro:after-swap",e);
</script></head> <body> <header> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex flex-wrap gap-y-2 justify-between"> <a href="/" class="font-semibold hover:underline underline-offset-2">
Blog
</a> <nav class="flex gap-1">  <a href="/archive" class="hover:underline underline-offset-2"> Archive </a> <span>/</span> <a href="/tags" class="hover:underline underline-offset-2"> Tags </a> <span>/</span> <a href="/categories" class="hover:underline underline-offset-2"> Categories </a> <span>/</span> <a href="/about" class="hover:underline underline-offset-2"> About </a>  </nav> </div>  </div> </header> <main>  <div class="mx-auto max-w-screen-sm px-5">  <div class="animate"> <a href="/archive" class="hover:underline underline-offset-2">
← Back to archive
</a> </div> <div class="space-y-1 my-10"> <div class="animate flex items-center gap-1.5"> <div class="font-base text-sm"> <time datetime="2019-01-03T00:00:00.000Z"> January 3, 2019 </time> </div> </div> <div class="animate text-2xl font-semibold text-black dark:text-white">  </div>  </div> <article class="animate"> <h2 id="title--building-reactive-application-with-akkadate--2019-01-03-234756categories--akkatags--akka">title : Building reactive application with Akka
date : 2019-01-03 23:47:56
categories : akka
tags : [akka]</h2>
<p><a href="https://www.infoq.com/articles/Building-Reactive-Applications-with-Akka">原文链接</a></p>
<p>The actor model provides the core functionality of reactive systems, defined in the Reactive Manifesto as responsive, resilient, elastic, and message driven.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">static</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Counter</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AbstractLoggingActor</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Message</span><span style="color:#E1E4E8"> { }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#B392F0">      receive</span><span style="color:#E1E4E8">(ReceiveBuilder</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">match</span><span style="color:#E1E4E8">(Message.class, </span><span style="color:#79B8FF">this</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">onMessage)</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onMessage</span><span style="color:#E1E4E8">(Message </span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">      counter</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Increased counter "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> counter);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>send message</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">counter.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Counter.</span><span style="color:#B392F0">Message</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span></code></pre>
<p>change actor behaviour</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onEnable</span><span style="color:#E1E4E8">(Enable enable) {</span></span>
<span class="line"><span style="color:#F97583">   if</span><span style="color:#E1E4E8"> (password.</span><span style="color:#B392F0">equals</span><span style="color:#E1E4E8">(enable.password)) {</span></span>
<span class="line"><span style="color:#B392F0">     log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Alarm enable"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">     getContext</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">become</span><span style="color:#E1E4E8">(enabled);</span></span>
<span class="line"><span style="color:#E1E4E8">   } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">     log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Someone failed to enable the alarm"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">ActorSystem system </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ActorSystem.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    final</span><span style="color:#E1E4E8"> ActorRef alarm </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> system.</span><span style="color:#B392F0">actorOf</span><span style="color:#E1E4E8">(Alarm.</span><span style="color:#B392F0">props</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), </span><span style="color:#9ECBFF">"alarm"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Enable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"dogs"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Enable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Disable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"dogs"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Disable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span></code></pre>
<p>Actors may create other actors. When one actor creates another actor, the <em>creator</em> is known as the <em>supervisor</em> and the <em>created actor</em> is known as the <em>worker</em>.</p>
<p>但是这种方式不被推荐？</p>
<p>If one actor does not have the means for dealing with a certain situation, it sends a corresponding failure message to its supervisor, asking for help. The supervisor has four different options for reacting to a failure:</p>
<ul>
<li><strong>Resume</strong> the child, keeping its accumulated internal state but ignoring the message that lead to the failure.</li>
<li><strong>Restart</strong> the child, clearing out its accumulated internal state by starting a new instance.</li>
<li><strong>Stop</strong> the child permanently and send all future messages for the child to the <a href="http://doc.akka.io/docs/akka/current/general/message-delivery-reliability.html#Dead_Letters">Dead-Letter Office</a>.</li>
<li><strong>Escalate</strong> the failure, thereby failing the supervisor itself</li>
</ul>
<p>针对actor的策略？</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Supervisor</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AbstractLoggingActor</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    final</span><span style="color:#E1E4E8"> ActorRef child </span><span style="color:#F97583">=</span><span style="color:#B392F0"> getContext</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">actorOf</span><span style="color:#E1E4E8">(NonTrustWorthyChild.</span><span style="color:#B392F0">props</span><span style="color:#E1E4E8">(), </span><span style="color:#9ECBFF">"child"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    receive</span><span style="color:#E1E4E8">(ReceiveBuilder</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">matchAny</span><span style="color:#E1E4E8">(command </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> child.</span><span style="color:#B392F0">forward</span><span style="color:#E1E4E8">(command, </span><span style="color:#B392F0">getContext</span><span style="color:#E1E4E8">()))</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#6A737D">  //…</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>supervisor是child？</p>
<p>Akka provides two classes of supervision strategies: <code>OneForOneStrategy</code> and <code>AllForOneStrategy.</code>The difference between them is that the former applies the obtained directive only to the failed child, whereas the latter applies it to all siblings as well. Normally, you should use the <code>OneForOneStrategy</code>, which is the default if none is explicitly specified. It is defined by overriding the <code>SupervisorStrategy</code> method.</p>
<p>The output shows, that after four messages the exception gets escalated to the <code>Supervisor</code> and the remaining messages are sent to the <code>deadLetters</code> box. If the <code>SupervisorStrategy</code> would have been defined to <code>restart()</code>instead of <code>stop()</code>, a new instance of the <code>NonTrustWorthyChild</code> actor would have been started.</p>
<p>关于子actor的策略，是restart还是stop</p> </article>  </div>  </main> <footer class="animate" data-astro-cid-sz7xmlte> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex justify-between items-center" data-astro-cid-sz7xmlte> <div data-astro-cid-sz7xmlte>
&copy; 2026 | Blog
</div> <div class="flex flex-wrap gap-1 items-center" data-astro-cid-sz7xmlte> <button id="light-theme-button" aria-label="Light theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <circle cx="12" cy="12" r="5" data-astro-cid-sz7xmlte></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-sz7xmlte></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-sz7xmlte></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-sz7xmlte></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-sz7xmlte></line> </svg> </button> <button id="dark-theme-button" aria-label="Dark theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-sz7xmlte></path> </svg> </button> <button id="system-theme-button" aria-label="System theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <rect x="2" y="3" width="20" height="14" rx="2" ry="2" data-astro-cid-sz7xmlte></rect> <line x1="8" y1="21" x2="16" y2="21" data-astro-cid-sz7xmlte></line> <line x1="12" y1="17" x2="12" y2="21" data-astro-cid-sz7xmlte></line> </svg> </button> </div> </div>  </div> </footer>  <script>
  function setTheme(theme) {
    document.documentElement.classList.remove("light", "dark", "system");
    
    if (theme === "system") {
      document.documentElement.classList.add("system");
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      document.documentElement.classList.add(systemTheme);
    } else {
      document.documentElement.classList.add(theme);
    }
    
    localStorage.setItem("theme", theme);
  }

  document.getElementById("light-theme-button")?.addEventListener("click", () => setTheme("light"));
  document.getElementById("dark-theme-button")?.addEventListener("click", () => setTheme("dark"));
  document.getElementById("system-theme-button")?.addEventListener("click", () => setTheme("system"));

  const savedTheme = localStorage.getItem("theme") || "system";
  setTheme(savedTheme);
</script>  </body> </html>