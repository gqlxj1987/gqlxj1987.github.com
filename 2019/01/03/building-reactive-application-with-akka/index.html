<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> January 3, 2019 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <h2 id="title--building-reactive-application-with-akkadate--2019-01-03-234756categories--akkatags--akka">title : Building reactive application with Akka
date : 2019-01-03 23:47:56
categories : akka
tags : [akka]</h2>
<p><a href="https://www.infoq.com/articles/Building-Reactive-Applications-with-Akka">原文链接</a></p>
<p>The actor model provides the core functionality of reactive systems, defined in the Reactive Manifesto as responsive, resilient, elastic, and message driven.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">static</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Counter</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AbstractLoggingActor</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Message</span><span style="color:#E1E4E8"> { }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#B392F0">      receive</span><span style="color:#E1E4E8">(ReceiveBuilder</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">match</span><span style="color:#E1E4E8">(Message.class, </span><span style="color:#79B8FF">this</span><span style="color:#F97583">::</span><span style="color:#E1E4E8">onMessage)</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onMessage</span><span style="color:#E1E4E8">(Message </span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">      counter</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Increased counter "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> counter);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>send message</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">counter.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Counter.</span><span style="color:#B392F0">Message</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span></code></pre>
<p>change actor behaviour</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onEnable</span><span style="color:#E1E4E8">(Enable enable) {</span></span>
<span class="line"><span style="color:#F97583">   if</span><span style="color:#E1E4E8"> (password.</span><span style="color:#B392F0">equals</span><span style="color:#E1E4E8">(enable.password)) {</span></span>
<span class="line"><span style="color:#B392F0">     log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Alarm enable"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">     getContext</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">become</span><span style="color:#E1E4E8">(enabled);</span></span>
<span class="line"><span style="color:#E1E4E8">   } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">     log</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">info</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Someone failed to enable the alarm"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">ActorSystem system </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ActorSystem.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    final</span><span style="color:#E1E4E8"> ActorRef alarm </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> system.</span><span style="color:#B392F0">actorOf</span><span style="color:#E1E4E8">(Alarm.</span><span style="color:#B392F0">props</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), </span><span style="color:#9ECBFF">"alarm"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Enable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"dogs"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Enable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Disable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"dogs"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Disable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"cat"</span><span style="color:#E1E4E8">), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">alarm.</span><span style="color:#B392F0">tell</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> Alarm.</span><span style="color:#B392F0">Activity</span><span style="color:#E1E4E8">(), ActorRef.</span><span style="color:#B392F0">noSender</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span></code></pre>
<p>Actors may create other actors. When one actor creates another actor, the <em>creator</em> is known as the <em>supervisor</em> and the <em>created actor</em> is known as the <em>worker</em>.</p>
<p>但是这种方式不被推荐？</p>
<p>If one actor does not have the means for dealing with a certain situation, it sends a corresponding failure message to its supervisor, asking for help. The supervisor has four different options for reacting to a failure:</p>
<ul>
<li><strong>Resume</strong> the child, keeping its accumulated internal state but ignoring the message that lead to the failure.</li>
<li><strong>Restart</strong> the child, clearing out its accumulated internal state by starting a new instance.</li>
<li><strong>Stop</strong> the child permanently and send all future messages for the child to the <a href="http://doc.akka.io/docs/akka/current/general/message-delivery-reliability.html#Dead_Letters">Dead-Letter Office</a>.</li>
<li><strong>Escalate</strong> the failure, thereby failing the supervisor itself</li>
</ul>
<p>针对actor的策略？</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Supervisor</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AbstractLoggingActor</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    final</span><span style="color:#E1E4E8"> ActorRef child </span><span style="color:#F97583">=</span><span style="color:#B392F0"> getContext</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">actorOf</span><span style="color:#E1E4E8">(NonTrustWorthyChild.</span><span style="color:#B392F0">props</span><span style="color:#E1E4E8">(), </span><span style="color:#9ECBFF">"child"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    receive</span><span style="color:#E1E4E8">(ReceiveBuilder</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">matchAny</span><span style="color:#E1E4E8">(command </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> child.</span><span style="color:#B392F0">forward</span><span style="color:#E1E4E8">(command, </span><span style="color:#B392F0">getContext</span><span style="color:#E1E4E8">()))</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#6A737D">  //…</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>supervisor是child？</p>
<p>Akka provides two classes of supervision strategies: <code>OneForOneStrategy</code> and <code>AllForOneStrategy.</code>The difference between them is that the former applies the obtained directive only to the failed child, whereas the latter applies it to all siblings as well. Normally, you should use the <code>OneForOneStrategy</code>, which is the default if none is explicitly specified. It is defined by overriding the <code>SupervisorStrategy</code> method.</p>
<p>The output shows, that after four messages the exception gets escalated to the <code>Supervisor</code> and the remaining messages are sent to the <code>deadLetters</code> box. If the <code>SupervisorStrategy</code> would have been defined to <code>restart()</code>instead of <code>stop()</code>, a new instance of the <code>NonTrustWorthyChild</code> actor would have been started.</p>
<p>关于子actor的策略，是restart还是stop</p> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 