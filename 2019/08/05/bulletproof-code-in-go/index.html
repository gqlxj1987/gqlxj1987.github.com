<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> August 5, 2019 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <p>title: Bulletproof code in go
date: 2019-08-05 19:42:08
categories: golang</p>
<h2 id="tags-golang">tags: [golang]</h2>
<p><a href="https://medium.com/free-code-camp/how-to-write-bulletproof-code-in-go-a-workflow-for-servers-that-cant-fail-10a14a765f22">原文链接</a></p>
<p>The task: building a server that really isn’t allowed to fail, a project where the cost of error is extraordinarily high</p>
<p>TDD is a great methodology that works well for some, but by itself it still isn’t enough. Even worse, TDD instills false confidence in code and may make developers lazy when considering paranoid edge cases.</p>
<p>No part of our confidence in our code can result from a manual QA process. Humans make mistakes. Human attention to detail deteriorates after doing the same mind-numbing task a hundred times in a row.</p>
<p>Tests must be fast. Blazingly fast.</p>
<p>If  a test suite takes more than a few seconds to run, developers are  likely going to become lazy, pushing code without running it.</p>
<p>Dealing gracefully with errors in runtime is a cornerstone for bulletproof code.</p>
<p>Complexity is the worst enemy of bulletproof code. One of the best ways to deal with complexity is <em>divide and conquer</em> — split the problem into smaller problems and solve each one separately.</p>
<p>面向接口编程，protobuf部分</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> spec</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#F97583"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> _ </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sanity"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">		node </span><span style="color:#B392F0">services</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Node</span></span>
<span class="line"><span style="color:#E1E4E8">	)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">	BeforeEach</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">		node </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> services.</span><span style="color:#B392F0">NewNode</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">		node.</span><span style="color:#B392F0">Start</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">	AfterEach</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">		node.</span><span style="color:#B392F0">Stop</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">	It</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"should show balances with GET /api/balance"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">		resp, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> http.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"http://localhost:8080/api/balance?from=user1"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">		Expect</span><span style="color:#E1E4E8">(err).</span><span style="color:#B392F0">ToNot</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">HaveOccurred</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#B392F0">		Expect</span><span style="color:#E1E4E8">(resp.StatusCode).</span><span style="color:#B392F0">To</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(http.StatusOK))</span></span>
<span class="line"><span style="color:#B392F0">		Expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ResponseBodyAsString</span><span style="color:#E1E4E8">(resp)).</span><span style="color:#B392F0">To</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"0"</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p><a href="https://golang.org/pkg/sync/#Map"><code>sync.Map</code></a></p>
<p><a href="https://github.com/orbs-network/go-scaffold">Scafford started project</a>包含各种测试目录部分，利用它来新建相关的project</p> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 