<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> July 15, 2018 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <h2 id="title-tsdb-from-scratchdate-2018-07-15-165537categories-tsdbtags-tsdb">title: TSDB from Scratch
date: 2018-07-15 16:55:37
categories: TSDB
tags: [TSDB]</h2>
<p><a href="https://fabxc.org/tsdb/">原文链接</a></p>
<h3 id="time-series-data">Time series data</h3>
<p>Each data point is a tuple of a timestamp and a value</p>
<p>A 64 bit float turns out to be a good representation for counter as well as gauge values, so we go with that. (时间戳？)</p>
<p>定义好相应的label部分</p>
<h3 id="vertical-and-horizontal">Vertical and Horizontal</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>series</span></span>
<span class="line"><span>  ^   </span></span>
<span class="line"><span>  │   . . . . . . . . . . . . . . . . .   . . . . .   {__name__="request_total", method="GET"}</span></span>
<span class="line"><span>  │     . . . . . . . . . . . . . . . . . . . . . .   {__name__="request_total", method="POST"}</span></span>
<span class="line"><span>  │         . . . . . . .</span></span>
<span class="line"><span>  │       . . .     . . . . . . . . . . . . . . . .                  ... </span></span>
<span class="line"><span>  │     . . . . . . . . . . . . . . . . .   . . . .   </span></span>
<span class="line"><span>  │     . . . . . . . . . .   . . . . . . . . . . .   {__name__="errors_total", method="POST"}</span></span>
<span class="line"><span>  │           . . .   . . . . . . . . .   . . . . .   {__name__="errors_total", method="GET"}</span></span>
<span class="line"><span>  │         . . . . . . . . .       . . . . .</span></span>
<span class="line"><span>  │       . . .     . . . . . . . . . . . . . . . .                  ... </span></span>
<span class="line"><span>  │     . . . . . . . . . . . . . . . .   . . . . </span></span>
<span class="line"><span>  v</span></span>
<span class="line"><span>    &#x3C;-------------------- time ---------------------></span></span>
<span class="line"><span></span></span></code></pre>
<p>关于写放大的问题？</p>
<p>解决方案:</p>
<ul>
<li>Writes are now batched, samples are stored sequentially</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> tree</span><span style="color:#9ECBFF"> ./data</span></span>
<span class="line"><span style="color:#B392F0">./data</span></span>
<span class="line"><span style="color:#B392F0">├──</span><span style="color:#9ECBFF"> b-000001</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> chunks</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   │</span><span style="color:#9ECBFF">   ├──</span><span style="color:#79B8FF"> 000001</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   │</span><span style="color:#9ECBFF">   ├──</span><span style="color:#79B8FF"> 000002</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   │</span><span style="color:#9ECBFF">   └──</span><span style="color:#79B8FF"> 000003</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> index</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   └──</span><span style="color:#9ECBFF"> meta.json</span></span>
<span class="line"><span style="color:#B392F0">├──</span><span style="color:#9ECBFF"> b-000004</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> chunks</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   │</span><span style="color:#9ECBFF">   └──</span><span style="color:#79B8FF"> 000001</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> index</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   └──</span><span style="color:#9ECBFF"> meta.json</span></span>
<span class="line"><span style="color:#B392F0">├──</span><span style="color:#9ECBFF"> b-000005</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> chunks</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   │</span><span style="color:#9ECBFF">   └──</span><span style="color:#79B8FF"> 000001</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   ├──</span><span style="color:#9ECBFF"> index</span></span>
<span class="line"><span style="color:#B392F0">│</span><span style="color:#9ECBFF">   └──</span><span style="color:#9ECBFF"> meta.json</span></span>
<span class="line"><span style="color:#B392F0">└──</span><span style="color:#9ECBFF"> b-000006</span></span>
<span class="line"><span style="color:#B392F0">    ├──</span><span style="color:#9ECBFF"> meta.json</span></span>
<span class="line"><span style="color:#B392F0">    └──</span><span style="color:#9ECBFF"> wal</span></span>
<span class="line"><span style="color:#B392F0">        ├──</span><span style="color:#79B8FF"> 000001</span></span>
<span class="line"><span style="color:#B392F0">        ├──</span><span style="color:#79B8FF"> 000002</span></span>
<span class="line"><span style="color:#B392F0">        └──</span><span style="color:#79B8FF"> 000003</span></span>
<span class="line"></span></code></pre>
<p>Queried data can be rather aggressively cached in memory, yet under memory pressure the pages will be evicted. If the machine has unused memory, Prometheus will now happily cache the entire database, yet will immediately return it once another application needs it.</p> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 