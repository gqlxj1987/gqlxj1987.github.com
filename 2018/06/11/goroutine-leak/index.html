<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> June 11, 2018 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <h2 id="title-goroutine-leakdate-2018-06-11-142413categories-golangtags-golang">title: Goroutine leak
date: 2018-06-11 14:24:13
categories: golang
tags: [golang]</h2>
<p><a href="https://medium.com/golangspec/goroutine-leak-400063aef468">原文链接</a></p>
<p>They leak if end up either blocked forever on I/O like channel communication or fall into infinite loops. Even blocked goroutine consumes resources so the program may use more memory than actually needed or eventually run out of memory and crash</p>
<h3 id="sending-to-a-channel-without-receiver">Sending to a channel without receiver</h3>
<p>channel部分的操作</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> "</span><span style="color:#B392F0">github.com/google/gops/agent</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#F97583">...</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> agent.</span><span style="color:#B392F0">Start</span><span style="color:#E1E4E8">(); err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    log.</span><span style="color:#B392F0">Fatal</span><span style="color:#E1E4E8">(err)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Hour)</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> .</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">gops</span></span>
<span class="line"><span style="color:#79B8FF">12365</span><span style="color:#E1E4E8">   gops    (</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">mlowicki</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">projects</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">golang</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">spec</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">gops)</span></span>
<span class="line"><span style="color:#79B8FF">12336</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">  lab     (</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">mlowicki</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">projects</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">golang</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">spec</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">lab)</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> .</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">gops vitals </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">p</span><span style="color:#F97583">=</span><span style="color:#79B8FF">12336</span></span>
<span class="line"><span style="color:#E1E4E8">goroutines: </span><span style="color:#79B8FF">14</span></span>
<span class="line"><span style="color:#E1E4E8">OS threads: </span><span style="color:#79B8FF">9</span></span>
<span class="line"><span style="color:#E1E4E8">GOMAXPROCS: </span><span style="color:#79B8FF">4</span></span>
<span class="line"><span style="color:#E1E4E8">num CPU: </span><span style="color:#79B8FF">4</span></span>
<span class="line"></span></code></pre>
<p>通过gops的引入</p>
<p>runtime.Stack的方式</p>
<p>Stack formats a stack trace of the calling goroutine into buf and returns the number of bytes written to buf. If all is true, Stack formats stack traces of all other goroutines into buf after the trace for the current goroutine.</p> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 