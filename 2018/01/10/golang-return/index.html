<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><meta name="description" content="Blog post"><title>Untitled</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_title_.8kzbYMPX.css"><script type="module">const e=()=>{document.querySelectorAll(".animate").forEach((t,s)=>{setTimeout(()=>{t.classList.add("show")},s*150)})};e();document.addEventListener("astro:after-swap",e);
</script></head> <body> <header> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex flex-wrap gap-y-2 justify-between"> <a href="/" class="font-semibold hover:underline underline-offset-2">
Blog
</a> <nav class="flex gap-1">  <a href="/archive" class="hover:underline underline-offset-2"> Archive </a> <span>/</span> <a href="/about" class="hover:underline underline-offset-2"> About </a>  </nav> </div>  </div> </header> <main>  <div class="mx-auto max-w-screen-sm px-5">  <div class="animate"> <a href="/archive" class="hover:underline underline-offset-2">
← Back to archive
</a> </div> <div class="space-y-1 my-10"> <div class="animate flex items-center gap-1.5"> <div class="font-base text-sm"> <time datetime="2018-01-10T00:00:00.000Z"> January 10, 2018 </time> </div> </div> <div class="animate text-2xl font-semibold text-black dark:text-white">  </div>  </div> <article class="animate"> <h2 id="title-golang-returndate-2018-01-10-102111categories-golangtags-golang">title: Golang Return
date: 2018-01-10 10:21:11
categories: golang
tags: [golang]</h2>
<p><a href="https://blog.minio.io/golang-internals-part-2-nice-benefits-of-named-return-values-1e95305c8687">Golang Internals Part 2: Nice benefits of named return values</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> objectInfo</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">	arg1 </span><span style="color:#F97583">int64</span></span>
<span class="line"><span style="color:#E1E4E8">	arg2 </span><span style="color:#F97583">uint64</span></span>
<span class="line"><span style="color:#E1E4E8">	arg3 </span><span style="color:#F97583">string</span></span>
<span class="line"><span style="color:#E1E4E8">	arg4 []</span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NoNamedReturnParams</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">i</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) (</span><span style="color:#B392F0">objectInfo</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do one thing</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#B392F0"> objectInfo</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do another thing</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#B392F0"> objectInfo</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do one more thing still</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#B392F0"> objectInfo</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	// Normal return</span></span>
<span class="line"><span style="color:#F97583">	return</span><span style="color:#B392F0"> objectInfo</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>actual code that the golang compiler generates</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>"".NoNamedReturnParams t=1 size=243 args=0x40 locals=0x0</span></span>
<span class="line"><span>0x0000 	TEXT	"".NoNamedReturnParams(SB), $0-64</span></span>
<span class="line"><span>0x0000 	MOVQ	$0, "".~r1+16(FP)</span></span>
<span class="line"><span>0x0009 	LEAQ	"".~r1+24(FP), DI</span></span>
<span class="line"><span>0x000e 	XORPS	X0, X0</span></span>
<span class="line"><span>0x0011 	ADDQ	$-16, DI</span></span>
<span class="line"><span>0x0015 	DUFFZERO	$288</span></span>
<span class="line"><span>0x0028 	MOVQ	"".i+8(FP), AX</span></span>
<span class="line"><span>0x002d 	CMPQ	AX, $1</span></span>
<span class="line"><span>0x0031 	JEQ	$0, 199</span></span>
<span class="line"><span>0x0037 	CMPQ	AX, $2</span></span>
<span class="line"><span>0x003b 	JEQ	$0, 155</span></span>
<span class="line"><span>0x003d 	CMPQ	AX, $3</span></span>
<span class="line"><span>0x0041 	JNE	111</span></span>
<span class="line"><span>0x0043 	MOVQ	"".statictmp_2(SB), AX</span></span>
<span class="line"><span>0x004a 	MOVQ	AX, "".~r1+16(FP)</span></span>
<span class="line"><span>0x004f 	LEAQ	"".~r1+24(FP), DI</span></span>
<span class="line"><span>0x0054 	LEAQ	"".statictmp_2+8(SB), SI</span></span>
<span class="line"><span>0x005b 	DUFFCOPY	$854</span></span>
<span class="line"><span>0x006e 	RET</span></span>
<span class="line"><span>0x006f 	MOVQ	"".statictmp_3(SB), AX</span></span>
<span class="line"><span>0x0076 	MOVQ	AX, "".~r1+16(FP)</span></span>
<span class="line"><span>0x007b 	LEAQ	"".~r1+24(FP), DI</span></span>
<span class="line"><span>0x0080 	LEAQ	"".statictmp_3+8(SB), SI</span></span>
<span class="line"><span>0x0087 	DUFFCOPY	$854</span></span>
<span class="line"><span>0x009a 	RET</span></span>
<span class="line"><span>0x009b 	MOVQ	"".statictmp_1(SB), AX</span></span>
<span class="line"><span>0x00a2 	MOVQ	AX, "".~r1+16(FP)</span></span>
<span class="line"><span>0x00a7 	LEAQ	"".~r1+24(FP), DI</span></span>
<span class="line"><span>0x00ac 	LEAQ	"".statictmp_1+8(SB), SI</span></span>
<span class="line"><span>0x00b3 	DUFFCOPY	$854</span></span>
<span class="line"><span>0x00c6 	RET</span></span>
<span class="line"><span>0x00c7 	MOVQ	"".statictmp_0(SB), AX</span></span>
<span class="line"><span>0x00ce 	MOVQ	AX, "".~r1+16(FP)</span></span>
<span class="line"><span>0x00d3 	LEAQ	"".~r1+24(FP), DI</span></span>
<span class="line"><span>0x00d8 	LEAQ	"".statictmp_0+8(SB), SI</span></span>
<span class="line"><span>0x00df 	DUFFCOPY	$854</span></span>
<span class="line"><span>0x00f2 	RET</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<blockquote>
<p>All fine and dandy, but if that looks a bit repetitive to you, you are quite right. Essentially for each of the <code>return</code> statements the object to be returned is more or less allocated/initialized (or more precisely copied via the <code>DUFFCOPY</code>macro).</p>
</blockquote>
<p>naked return feature of golang</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NamedReturnParams</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">i</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">oi</span><span style="color:#B392F0"> objectInfo</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do one thing</span></span>
<span class="line"><span style="color:#F97583">		return</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do another thing</span></span>
<span class="line"><span style="color:#F97583">		return</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">		// Do one more thing still</span></span>
<span class="line"><span style="color:#F97583">		return</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	// Normal return</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>It reduces the size of the function down from <code>243</code> to <code>67</code> bytes. Also as an additional benefit you will save some CPU cycles upon exiting out because there is no need anymore to do anything in order to setup the return value.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// parse credentialHeader string into its structured form.</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> parseCredentialHeader</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">credElement</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">ch</span><span style="color:#B392F0"> credentialHeader</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    creds </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> strings.</span><span style="color:#B392F0">Split</span><span style="color:#E1E4E8">(strings.</span><span style="color:#B392F0">TrimSpace</span><span style="color:#E1E4E8">(credElement), </span><span style="color:#9ECBFF">"="</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(creds) </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> creds[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> "Credential"</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    credElements </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> strings.</span><span style="color:#B392F0">Split</span><span style="color:#E1E4E8">(strings.</span><span style="color:#B392F0">TrimSpace</span><span style="color:#E1E4E8">(creds[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]), </span><span style="color:#9ECBFF">"/"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(credElements) </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> false</span><span style="color:#6A737D"> /*!isAccessKeyValid(credElements[0])*/</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // Save access key id.</span></span>
<span class="line"><span style="color:#E1E4E8">    cred </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> credentialHeader</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">	accessKey: credElements[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> e </span><span style="color:#F97583">error</span></span>
<span class="line"><span style="color:#E1E4E8">    cred.scope.date, e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> time.</span><span style="color:#B392F0">Parse</span><span style="color:#E1E4E8">(yyyymmdd, credElements[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> e </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    cred.scope.region </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> credElements[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> credElements[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> "s3"</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    cred.scope.service </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> credElements[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> credElements[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> "aws4_request"</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    cred.scope.request </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> credElements[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> cred</span></span>
<span class="line"><span style="color:#E1E4E8">} </span></span>
<span class="line"></span></code></pre>
<p>隐含的return value的方式</p>
<p>Note that actually the <code>ch</code> variable is a normal local variable just like any other local variable that is defined within the function. And as such you can change its value from the default ‘zero’ state (but of course then the modified version will be returned upon exiting out).</p>
<h4 id="others-uses-of-named-return-values">others uses of named return values</h4>
<p>As pointed out by several persons, another benefit of named return values is the use in closures (i.e. defer statements). Thus one may access the named return value in a function that is called as the result of a <code>defer</code> statement and act accordingly.</p>
<h4 id="conclusion">conclusion</h4>
<p>So we will be gradually adopting named return values more and more, both for new code as well as for existing code.</p>
<p>future to integration with <code>gofmt</code> to modify the source automatically</p> </article>  </div>  </main> <footer class="animate" data-astro-cid-sz7xmlte> <div class="mx-auto max-w-screen-sm px-5">  <div class="flex justify-between items-center" data-astro-cid-sz7xmlte> <div data-astro-cid-sz7xmlte>
&copy; 2026 | Blog
</div> <div class="flex flex-wrap gap-1 items-center" data-astro-cid-sz7xmlte> <button id="light-theme-button" aria-label="Light theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <circle cx="12" cy="12" r="5" data-astro-cid-sz7xmlte></circle> <line x1="12" y1="1" x2="12" y2="3" data-astro-cid-sz7xmlte></line> <line x1="12" y1="21" x2="12" y2="23" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-astro-cid-sz7xmlte></line> <line x1="1" y1="12" x2="3" y2="12" data-astro-cid-sz7xmlte></line> <line x1="21" y1="12" x2="23" y2="12" data-astro-cid-sz7xmlte></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-astro-cid-sz7xmlte></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-astro-cid-sz7xmlte></line> </svg> </button> <button id="dark-theme-button" aria-label="Dark theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-sz7xmlte></path> </svg> </button> <button id="system-theme-button" aria-label="System theme" class="group size-8 flex items-center justify-center rounded-full" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out" data-astro-cid-sz7xmlte> <rect x="2" y="3" width="20" height="14" rx="2" ry="2" data-astro-cid-sz7xmlte></rect> <line x1="8" y1="21" x2="16" y2="21" data-astro-cid-sz7xmlte></line> <line x1="12" y1="17" x2="12" y2="21" data-astro-cid-sz7xmlte></line> </svg> </button> </div> </div>  </div> </footer>  <script>
  function setTheme(theme) {
    document.documentElement.classList.remove("light", "dark", "system");
    
    if (theme === "system") {
      document.documentElement.classList.add("system");
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      document.documentElement.classList.add(systemTheme);
    } else {
      document.documentElement.classList.add(theme);
    }
    
    localStorage.setItem("theme", theme);
  }

  document.getElementById("light-theme-button")?.addEventListener("click", () => setTheme("light"));
  document.getElementById("dark-theme-button")?.addEventListener("click", () => setTheme("dark"));
  document.getElementById("system-theme-button")?.addEventListener("click", () => setTheme("system"));

  const savedTheme = localStorage.getItem("theme") || "system";
  setTheme(savedTheme);
</script>  </body> </html>