<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> May 22, 2018 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <h2 id="title-go-the-good-the-bad-and-the-uglydate-2018-05-22-170431categories-golangtags-golang">title: Go the good, the bad and the ugly
date: 2018-05-22 17:04:31
categories: golang
tags: [golang]</h2>
<p><a href="https://bluxte.net/musings/2018/04/10/go-good-bad-ugly/?utm_campaign=CodeTengu&#x26;utm_medium=email&#x26;utm_source=CodeTengu_127">原文链接</a></p>
<h3 id="good">Good</h3>
<p>new Types</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> UserId</span><span style="color:#F97583"> string</span><span style="color:#6A737D"> // &#x3C;-- new type</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ProductId</span><span style="color:#F97583"> string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> AddProduct</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">userId</span><span style="color:#B392F0"> UserId</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">productId</span><span style="color:#B392F0"> ProductId</span><span style="color:#E1E4E8">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    userId </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> UserId</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"some-user-id"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    productId </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> ProductId</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"some-product-id"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Right order: all fine</span></span>
<span class="line"><span style="color:#B392F0">    AddProduct</span><span style="color:#E1E4E8">(userId, productId)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Wrong order: would compile with raw strings</span></span>
<span class="line"><span style="color:#B392F0">    AddProduct</span><span style="color:#E1E4E8">(productId, userId)</span></span>
<span class="line"><span style="color:#6A737D">    // Compilation errors:</span></span>
<span class="line"><span style="color:#6A737D">    // cannot use productId (type ProductId) as type UserId in argument to AddProduct</span></span>
<span class="line"><span style="color:#6A737D">    // cannot use userId (type UserId) as type ProductId in argument to AddProduct</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="bad">Bad</h3>
<h4 id="go-ignored-advances-in-modern-language-design">Go ignored advances in modern language design</h4>
<p><strong>functional programing</strong></p>
<p><strong>No LLVM</strong></p>
<p><strong>GC</strong></p>
<h4 id="interfaces-are-structural-types">Interfaces are structural types</h4>
<p>Go interfaces are like Java interfaces or Scala &#x26; Rust traits: they define behaviour that is later implemented by a type (I won’t call it “class” here).</p>
<h3 id="no-enumerations">No enumerations</h3>
<p><code>iota</code></p>
<h3 id="thevar-dilemma">The<code>:=</code>/<code>var</code> dilemma</h3>
<p>Go provides two ways to declare a variable and assign it a value: <code>var x = "foo"</code> and <code>x := "foo"</code>.</p>
<p>The main differences are that <code>var</code> allows declaration without initialization (and you then have to declare the type), like in <code>var x string</code>, whereas <code>:=</code> requires assignment and allows a mix of existing and new variables. My guess is that <code>:=</code> was invented to make error handling <em>a bit</em> less painful:</p>
<h4 id="zero-values-that-panic">Zero values that panic</h4>
<p>go have no constructor</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> m1 </span><span style="color:#F97583">=</span><span style="color:#F97583"> map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{} </span><span style="color:#6A737D">// empty map</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> m0 </span><span style="color:#F97583">map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">string</span><span style="color:#6A737D">     // zero map (nil)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">println</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(m1))   </span><span style="color:#6A737D">// outputs '0'</span></span>
<span class="line"><span style="color:#B392F0">println</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(m0))   </span><span style="color:#6A737D">// outputs '0'</span></span>
<span class="line"><span style="color:#B392F0">println</span><span style="color:#E1E4E8">(m1[</span><span style="color:#9ECBFF">"foo"</span><span style="color:#E1E4E8">]) </span><span style="color:#6A737D">// outputs ''</span></span>
<span class="line"><span style="color:#B392F0">println</span><span style="color:#E1E4E8">(m0[</span><span style="color:#9ECBFF">"foo"</span><span style="color:#E1E4E8">]) </span><span style="color:#6A737D">// outputs ''</span></span>
<span class="line"><span style="color:#E1E4E8">m1[</span><span style="color:#9ECBFF">"foo"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "bar"</span><span style="color:#6A737D">  // ok</span></span>
<span class="line"><span style="color:#E1E4E8">m0[</span><span style="color:#9ECBFF">"foo"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "bar"</span><span style="color:#6A737D">  // panics!</span></span>
<span class="line"></span></code></pre>
<p>上面所示，m1初始化了，但m0没有初始化。。</p>
<h4 id="go-doesnt-have-exceptions">Go doesn’t have exceptions.</h4>
<p>just  “<a href="https://blog.golang.org/defer-panic-and-recover">Defer, panic and recover</a>”</p>
<h3 id="ugly">Ugly</h3>
<h4 id="the-dependency-management-nightmare">The dependency management nightmare</h4>
<p>Things are getting better though: <code>dep</code>, the <a href="https://golang.github.io/dep/">official dependency management tool</a> was recently introduced to support vendoring.</p>
<p>But <code>dep</code> may not live long though as <a href="https://github.com/golang/vgo"><code>vgo</code></a>, also from Google, wants to bring versioning in the language itself and has been making some waves lately.</p>
<h4 id="mutability-is-hardcoded-in-the-language">mutability is hardcoded in the language</h4>
<p>Go makes it easy however to copy an entire struct with a simple assignment, so we may think that passing arguments by value is all that is needed to have immutability at the cost of copying.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> S</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    A </span><span style="color:#F97583">string</span></span>
<span class="line"><span style="color:#E1E4E8">    B []</span><span style="color:#F97583">string</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    x </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> S</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">"x-A"</span><span style="color:#E1E4E8">, []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">"x-B"</span><span style="color:#E1E4E8">}}</span></span>
<span class="line"><span style="color:#E1E4E8">    y </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> x </span><span style="color:#6A737D">// copy the struct</span></span>
<span class="line"><span style="color:#E1E4E8">    y.A </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "y-A"</span></span>
<span class="line"><span style="color:#E1E4E8">    y.B[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "y-B"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(x, y)</span></span>
<span class="line"><span style="color:#6A737D">    // Outputs "{x-A [y-B]} {y-A [y-B]}" -- x was modified!</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And the since built-in collections (map, slice and array) are references and are mutable, copying a struct that contains one of these just copies the pointer to the same underlying memory.</p>
<h4 id="slice-gotchas">Slice gotchas</h4>
<p>Slices come with many gotchas: as explained in “<a href="https://blog.golang.org/go-slices-usage-and-internals">Go slices: usage and internals</a>”, re-slicing a slice doesn’t copy the underlying array for performance reasons.</p>
<p>This is a laudable goal but means that sub-slices of a slice are just views that follow the mutations of the original slice. So don’t forget to <code>copy()</code> a slice if you want to separate it from its origin.</p>
<p>Forgetting to <code>copy()</code> becomes more dangerous with the <code>append</code> function: appending values to a slice resizes the underlying array <em>if it doesn’t have enough capacity</em> to hold the new values. This means that the result of <code>append</code> may or may not point to the original array depending on its initial capacity. This can cause hard to find non deterministic bugs. (在append的时候，如果没有足够的空间，会重新resize slice，这样pointer会乱指)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> doStuff</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"value=</span><span style="color:#79B8FF">%v\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, value)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    value2 </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> value[:]</span></span>
<span class="line"><span style="color:#E1E4E8">    value2 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(value2, </span><span style="color:#9ECBFF">"b"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"value=</span><span style="color:#79B8FF">%v</span><span style="color:#9ECBFF">, value2=</span><span style="color:#79B8FF">%v\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, value, value2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    value2[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "z"</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"value=</span><span style="color:#79B8FF">%v</span><span style="color:#9ECBFF">, value2=</span><span style="color:#79B8FF">%v\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, value, value2)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    slice1 </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">} </span><span style="color:#6A737D">// length 1, capacity 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    doStuff</span><span style="color:#E1E4E8">(slice1)</span></span>
<span class="line"><span style="color:#6A737D">    // Output:</span></span>
<span class="line"><span style="color:#6A737D">    // value=[a] -- ok</span></span>
<span class="line"><span style="color:#6A737D">    // value=[a], value2=[a b] -- ok: value unchanged, value2 updated</span></span>
<span class="line"><span style="color:#6A737D">    // value=[a], value2=[z b] -- ok: value unchanged, value2 updated</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    slice10 </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// length 1, capacity 10</span></span>
<span class="line"><span style="color:#E1E4E8">    slice10[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "a"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    doStuff</span><span style="color:#E1E4E8">(slice10)</span></span>
<span class="line"><span style="color:#6A737D">    // Output:</span></span>
<span class="line"><span style="color:#6A737D">    // value=[a] -- ok</span></span>
<span class="line"><span style="color:#6A737D">    // value=[a], value2=[a b] -- ok: value unchanged, value2 updated</span></span>
<span class="line"><span style="color:#6A737D">    // value=[z], value2=[z b] -- WTF?!? value changed???</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h4 id="mutability-and-channels-race-conditions-made-easy">mutability and channels: race conditions made easy</h4>
<p>As we saw above there is no way in Go to have immutable data structures. This means that once we send a pointer on a channel, it’s game over: we share mutable data between concurrent processes. Of course a channel of structures (and not pointers) copies the values sent on the channel, but as we saw above, this doesn’t deep-copy references, including slices and maps, which are intrinsically mutable. Same goes with struct fields of an interface type: they are pointers, and any mutation method defined by the interface is an open door to race conditions.</p>
<h4 id="noisy-error-management">noisy error management</h4>
<p>In “<a href="https://blog.golang.org/errors-are-values">Error has values</a>” Rob Pike suggests some strategies to reduce error handling verbosity</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>type errWriter struct {</span></span>
<span class="line"><span>    w   io.Writer</span></span>
<span class="line"><span>    err error</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>func (ew *errWriter) write(buf []byte) {</span></span>
<span class="line"><span>    if ew.err != nil {</span></span>
<span class="line"><span>        return // Write nothing if we already errored-out</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    _, ew.err = ew.w.Write(buf)</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>func doIt(fd io.Writer) {</span></span>
<span class="line"><span>    ew := &#x26;errWriter{w: fd}</span></span>
<span class="line"><span>    ew.write(p0[a:b])</span></span>
<span class="line"><span>    ew.write(p1[c:d])</span></span>
<span class="line"><span>    ew.write(p2[e:f])</span></span>
<span class="line"><span>    // and so on</span></span>
<span class="line"><span>    if ew.err != nil {</span></span>
<span class="line"><span>        return ew.err</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="nil-interface-values">nil interface values</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> Explodes</span><span style="color:#F97583"> interface</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    Bang</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#B392F0">    Boom</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Type Bomb implements Explodes</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> Bomb</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#B392F0">Bomb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Bang</span><span style="color:#E1E4E8">() {}</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Bomb</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Boom</span><span style="color:#E1E4E8">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> bomb </span><span style="color:#F97583">*</span><span style="color:#B392F0">Bomb</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> nil</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> explodes </span><span style="color:#B392F0">Explodes</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> bomb</span></span>
<span class="line"><span style="color:#B392F0">    println</span><span style="color:#E1E4E8">(bomb, explodes) </span><span style="color:#6A737D">// '0x0 (0x10a7060,0x0)'</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> explodes </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Not nil!"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 'Not nil!' What are we doing here?!?!</span></span>
<span class="line"><span style="color:#E1E4E8">        explodes.</span><span style="color:#B392F0">Bang</span><span style="color:#E1E4E8">()     </span><span style="color:#6A737D">// works fine</span></span>
<span class="line"><span style="color:#E1E4E8">        explodes.</span><span style="color:#B392F0">Boom</span><span style="color:#E1E4E8">()     </span><span style="color:#6A737D">// panic: value method main.Bomb.Boom called using nil *Bomb pointer</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"nil!"</span><span style="color:#E1E4E8">)     </span><span style="color:#6A737D">// why don't we end up here?</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h4 id="struct-field-tags-runtime-dsl-in-a-string">struct field tags: runtime DSL in a string</h4>
<h4 id="go-has-few-data-structures-beyond-slice-and-map">Go has few data structures beyond slice and map</h4> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 