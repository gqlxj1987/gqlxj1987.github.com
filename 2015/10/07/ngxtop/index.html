<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> October 7, 2015 </time> <h1 class="post-title" data-astro-cid-rl3favg5></h1> <div class="post-meta" data-astro-cid-rl3favg5>   </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <h2 id="title-ngxtop命令使用date-2015-10-07-224224categories-ngxtoptags-ngxtop">title: ngxtop命令使用
date: 2015-10-07 22:42:24
categories: ngxtop
tags: [ngxtop]</h2>
<p>ngxtop作为分析nginx日志一个很重要的工具，记录一些相关的使用和命令部分</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">ngxtop</span><span style="color:#79B8FF"> --help</span></span>
<span class="line"></span></code></pre>
<p>一些说明:</p>
<p>Options:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-l &#x3C;file>, --access-log &#x3C;file> access log file to parse</span></span>
<span class="line"><span></span></span></code></pre>
<p>指定access log</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-f &#x3C;format>, --log-format &#x3C;format> log format as specify in log_format directive. [default: combined]</span></span>
<span class="line"><span></span></span></code></pre>
<p>指定 log format</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>--no-follow ngxtop default behavior is to ignore current lines in log and only watch for new lines as they are written to the access log. Use this flag to tell ngxtop to process the current content of the access log instead</span></span>
<span class="line"><span></span></span></code></pre>
<p>ngxtop默认会对accesslog的新增行进行统计， 通过这个选项可以让ngxtop统计旧log</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-t &#x3C;seconds>, --interval &#x3C;seconds> report interval when running in follow mode [default: 2.0]</span></span>
<span class="line"><span></span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-g &#x3C;var>, --group-by &#x3C;var> group by variable [default: request_path]</span></span>
<span class="line"><span></span></span></code></pre>
<p>基于字段分组</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-w &#x3C;var>, --having &#x3C;expr> having clause [default: 1]</span></span>
<span class="line"><span></span></span></code></pre>
<p>分组之后再筛选</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-o &#x3C;var>, --order-by &#x3C;var> order of output for default query [default: count]</span></span>
<span class="line"><span></span></span></code></pre>
<p>排序字段</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-n &#x3C;number>, --limit &#x3C;number> limit the number of records included in report for top command [default: 10]</span></span>
<span class="line"><span></span></span></code></pre>
<p>默认显示前多少条</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span> -a &#x3C;exp> ..., --a &#x3C;exp> ... add exp (must be aggregation exp: sum, avg, min, max, etc.) into output </span></span>
<span class="line"><span></span></span></code></pre>
<p>对输出字段做附加条件 sum/avg/min/max 可选</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-v, --verbose more verbose output</span></span>
<span class="line"><span>-d, --debug print every line and parsed record</span></span>
<span class="line"><span>-h, --help print this help message.</span></span>
<span class="line"><span>--version print version information.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Advanced / experimental options:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-c &#x3C;file>, --config &#x3C;file> allow ngxtop to parse nginx config file for log format and location </span></span>
<span class="line"><span></span></span></code></pre>
<p>指定nginx config文件，ngxtop 会自动解析配置文件，分析出access log的位置以及格式</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-i &#x3C;filter-expression>, --filter &#x3C;filter-expression> filter in, records satisfied given expression are processed</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-p &#x3C;filter-expression>, --pre-filter &#x3C;filter-expression> in-filter expression to check in pre-parsing phase</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>常用的一些demo：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ngxtop</span><span style="color:#79B8FF"> -l</span><span style="color:#9ECBFF"> nginx.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">top</span><span style="color:#79B8FF"> 10</span><span style="color:#9ECBFF"> request</span><span style="color:#9ECBFF"> path</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> status</span><span style="color:#9ECBFF"> 404:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ngxtop</span><span style="color:#9ECBFF"> top</span><span style="color:#9ECBFF"> request_path</span><span style="color:#79B8FF"> --filter</span><span style="color:#9ECBFF"> 'status == 404'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">top</span><span style="color:#79B8FF"> 10</span><span style="color:#9ECBFF"> requests</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> highest</span><span style="color:#9ECBFF"> total</span><span style="color:#9ECBFF"> bytes</span><span style="color:#9ECBFF"> sent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ngxtop</span><span style="color:#79B8FF"> --order-by</span><span style="color:#9ECBFF"> 'avg(bytes_sent) * count'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">top</span><span style="color:#79B8FF"> 10</span><span style="color:#9ECBFF"> remote</span><span style="color:#9ECBFF"> address</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ngxtop</span><span style="color:#79B8FF"> --group-by</span><span style="color:#9ECBFF"> remote_addr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">find</span><span style="color:#9ECBFF"> request</span><span style="color:#9ECBFF"> with</span><span style="color:#9ECBFF"> 4xx</span><span style="color:#9ECBFF"> or</span><span style="color:#9ECBFF"> 5xx</span><span style="color:#9ECBFF"> status</span><span style="color:#E1E4E8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> ngxtop</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> 'status >= 400'</span><span style="color:#79B8FF"> -l</span><span style="color:#9ECBFF"> nginx.log</span></span>
<span class="line"></span>
<span class="line"></span></code></pre> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 