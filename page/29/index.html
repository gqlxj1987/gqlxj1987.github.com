<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gqlxj1987.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="DevilKing&#39;s blog">
<meta property="og:url" content="https://gqlxj1987.github.io/page/29/index.html">
<meta property="og:site_name" content="DevilKing&#39;s blog">
<meta property="og:locale">
<meta property="article:author" content="gqlxj1987">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://gqlxj1987.github.io/page/29/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>DevilKing's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">DevilKing's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">冷灯看剑，剑上几分功名？炉香无需计苍生，纵一穿烟逝，万丈云埋，孤阳还照古陵</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gqlxj1987.github.io/2019/10/09/build-trust-infra/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gqlxj1987">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DevilKing's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/09/build-trust-infra/" class="post-title-link" itemprop="url">Build trust infra</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-09 11:09:08" itemprop="dateCreated datePublished" datetime="2019-10-09T11:09:08+08:00">2019-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 15:19:52" itemprop="dateModified" datetime="2022-01-08T15:19:52+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/architecture/" itemprop="url" rel="index"><span itemprop="name">architecture</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://github.com/phodal/trusted">原文链接</a></p>
<p><strong>先自顶向下设计，再自底向上实践</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7rrz26eo0j31fq0qw10w.jpg" alt="image-20191009111258731"></p>
<p>设计系统的时候，也会有一些偏好：</p>
<ul>
<li>不多也不少：即不做多余的设计，也不缺少关键部分的设计。</li>
<li>演进式：不断让架构适应当前的环境。</li>
<li>持续性：长期的架构改进，比什么都重要。</li>
</ul>
<p>演进式+持续性</p>
<p>C4模型</p>
<blockquote>
<p>C4 代表上下文（Context）、容器（Container）、组件（Component）和代码（Code）——一系列分层的图表，可以用这些图表来描述不同缩放级别的软件架构，每种图表都适用于不同的受众。—— Simon Brown 《程序员必读之软件架构》</p>
</blockquote>
<p>高度自动化的工作流以及可视化</p>
<p>设计架构的适应度部分，</p>
<p>一个合理的 README 应该包含：</p>
<ul>
<li>项目简介：用一两句话简单描述该项目所实现的业务功能；</li>
<li>技术选型：列出项目的技术栈，包括语言、框架和中间件等；</li>
<li>本地构建：列出本地开发过程中所用到的工具命令；</li>
<li>领域模型：核心的领域概念，比如对于示例电商系统来说有Order、Product等；</li>
<li>测试策略：自动化测试如何分类，哪些必须写测试，哪些没有必要写测试；</li>
<li>技术架构：技术架构图；</li>
<li>部署架构：部署架构图；</li>
<li>外部依赖：项目运行时所依赖的外部集成方，比如订单系统会依赖于会员系统；</li>
<li>环境信息：各个环境的访问方式，数据库连接等；</li>
<li>编码实践：统一的编码实践，比如异常处理原则、分页封装等；</li>
<li>FAQ：开发过程中常见问题的解答。</li>
</ul>
<p>边界限定的系统架构</p>
<p>过去，我们采用模块化来划定包之间依赖关系；现在采用的是微服务化取代了部分内部包依赖。即以 HTTP 请求代替来函数调用。</p>
<p>所以，我们将<strong>巨型单体应用</strong>（陷阱 11 ）视为一种毒瘤，顺带强调一下<strong>巨型！巨型！巨型！</strong></p>
<p>适配层，而非被接口适配</p>
<blockquote>
<p>事件风暴（Event Stroming）是一项团队活动，旨在通过领域事件识别出聚合根，进而划分微服务的限界上下文。</p>
</blockquote>
<p>通过领域事件来划分边界</p>
<p>应用微化架构</p>
<p>实现上它是一种：</p>
<ul>
<li><strong>构建时拆分架构</strong>。</li>
<li><strong>代码删除架构</strong>。笑，以删代码的方式，来形成每个前端应用。</li>
<li><strong>微前端准备式架构</strong>。即，随时可以拆分为多个前端应用。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gqlxj1987.github.io/2019/10/08/Java-meets-reactive-programing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gqlxj1987">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DevilKing's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/08/Java-meets-reactive-programing/" class="post-title-link" itemprop="url">Java meets reactive programing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-08 17:28:31" itemprop="dateCreated datePublished" datetime="2019-10-08T17:28:31+08:00">2019-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 15:19:52" itemprop="dateModified" datetime="2022-01-08T15:19:52+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reactive/" itemprop="url" rel="index"><span itemprop="name">reactive</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://medium.com/wolox-driving-innovation/reactor-java-meets-reactive-programming-16105c026fc3">原文链接</a></p>
<p><em>Reactor</em> is a reactive programming library for the Java language which provides the basis for developing non-blocking applications, thus representing a change in how we think about an application’s execution model.</p>
<p>Reactive Programming follows the <em>Observer</em>design pattern which means that when an object’s status changes, the other objects are notified and updated, thus reducing the inefficient use of resources.</p>
<p>Backpressure grants the <em>Consumer</em>of an asynchronous stream the ability to tell the <em>Producer</em>the amount of data that must be sent to prevent the issuance of events at a rate that is faster than the processing capabilities.  反向驱动？</p>
<p>Reactor has two reactive types that implement the Publisher interface, but also provide a broad set of operators: *Flux<T>*and <em>Mono<T>.</em></p>
<p>A <em>Mono</em>object represents a single or empty value result (0..1) and allows deterministic generation from scratch or a sequence from arbitrary callback types. 相比较，多一个callback</p>
<p>drawbacks:</p>
<ul>
<li><p>More intensive memory usage is needed to store large data-flows as they are maintained for a long time.</p>
</li>
<li><p>It may be a little different from conventional programming, and it may be hard to understand in the beginning.</p>
</li>
<li><p>Most of the complexities must be dealt with at the time of declaring the service.</p>
</li>
<li><p>It doesn’t work well for applications that have very little data flow, as it can deem simple programming unnecessarily complex, or possibly even affect the performance.</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gqlxj1987.github.io/2019/10/08/write-code-easy-to-delete/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gqlxj1987">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DevilKing's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/08/write-code-easy-to-delete/" class="post-title-link" itemprop="url">Write code easy to delete</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-08 16:58:58" itemprop="dateCreated datePublished" datetime="2019-10-08T16:58:58+08:00">2019-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 15:19:52" itemprop="dateModified" datetime="2022-01-08T15:19:52+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://programmingisterrible.com/post/139222674273/write-code-that-is-easy-to-delete-not-easy-to">原文链接</a></p>
<p>Instead of building re-usable software, we should try to build disposable software.</p>
<p>To write code that’s easy to delete: repeat yourself to avoid creating dependencies, but don’t repeat yourself to manage them. </p>
<p>Layer your code too: build simple-to-use APIs out of simpler-to-implement but clumsy-to-use parts. </p>
<p>Split your code: isolate the hard-to-write and the likely-to-change parts from the rest of the code, and each other. </p>
<p>Don’t hard code every choice, and maybe allow changing a few at runtime. </p>
<p>Don’t try to do all of these things at the same time, and maybe don’t write so much code in the first place.</p>
<ul>
<li>the easiest code to delete is the code you avoided writing in the first place.</li>
<li>It’s good to copy-paste code a couple of times, rather than making a library function, just to get a handle on how it will be used. Once you make something a shared API, you make it harder to change.</li>
<li>Instead of making code easy-to-delete, we are trying to keep the hard-to-delete parts as far away as possible from the easy-to-delete parts. use utils</li>
<li>Boiler plate is a lot like copy-pasting, but you change some of the code in a different place each time, rather than the same bit over and over. write more boilerplate</li>
<li>don’t write boilerplate. good api, 足够多的封装</li>
<li>Everything should be built top-down, except the first time</li>
<li>Instead of breaking code into parts with common functionality, we break code apart by what it does not share with the rest. We isolate the most frustrating parts to write, maintain, or delete away from each other.</li>
</ul>
<p>Error handling, and recovery are best done at the outer layers of your code base. This is known as the end-to-end principle.</p>
<p>Good examples of loose coupling are often examples of uniform interfaces.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gqlxj1987.github.io/2019/09/23/istio-intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gqlxj1987">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DevilKing's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/23/istio-intro/" class="post-title-link" itemprop="url">Istio Intro</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-23 16:14:05" itemprop="dateCreated datePublished" datetime="2019-09-23T16:14:05+08:00">2019-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 15:19:52" itemprop="dateModified" datetime="2022-01-08T15:19:52+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/istio/" itemprop="url" rel="index"><span itemprop="name">istio</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://medium.com/avitotech/running-istio-on-kubernetes-in-production-part-i-a8bbf7fec18e">原文链接</a></p>
<p><img src="https://miro.medium.com/max/2596/1*Qz-ejoBJsCHU7Xnxunn50w.png" alt="istio components"></p>
<ul>
<li>Pilot is the main control component that distributes all information about what we keep inside the cluster — services, their endpoints and routing rules (for example, the rules of canary deployment or the circuit breaker rules).</li>
<li>Mixer is an optional control plane component that provides the ability to collect metrics, logs, and any information about network interactions. It also monitors compliance with policy rules and compliance with the rate limits.</li>
<li>The data plane component is implemented using sidecar proxy containers.By default, a powerful <a target="_blank" rel="noopener" href="https://www.envoyproxy.io/">proxy server envoy</a>is used</li>
</ul>
<p>整体的流程：</p>
<ol>
<li>We deploy a new version of the service.</li>
<li>Depending on the sidecar container injection type, an istio-init container and istio-agent container (envoy) are added during the configuration phase, or they can be manually inserted into the pod description of the kubernetes entity.</li>
<li>The istio-init container is a script that applies the iptables rules for a pod. There are two ways to configure traffic redirecting to an istio-agent container: using redirect iptables rules or <a target="_blank" rel="noopener" href="https://github.com/kristrev/tproxy-example/blob/master/tproxy_example.c">TPROXY</a>. At the writing moment, the default is using redirect rules. In istio-init, it is possible to configure which traffic will be intercepted and sent to istio-agent. For example, in order to intercept all incoming and all outgoing traffic, you need to set the parameters <code>-i</code>and <code>-b</code>to <code>*</code>. You can specify specific ports to be intercepted. To avoid intercepting a certain subnet, you can specify it using the <code>-x</code>flag.</li>
<li>After init execution, the containers, including pilot-agent (envoy), are launched. It connects to the deployed Pilot by GRPC and gets information about all existing services and routing policies in the cluster. According to the received data, it configures the cluster and maps these directly to the application endpoints in the k8s cluster. There is an important moment: envoy dynamically configures listeners (IP, port pairs) that start listening. Therefore, when requests enter the pod and are redirected using iptables rules to sidecar, envoy is prepared to handle these connections and understands where to forward the proxy traffic. In this step, the information is sent to the Mixer, which we will be described below.</li>
</ol>
<p>Mixer has two components: istio-telemetry, istio-policy (up to version 0.8, it used to be a single component istio-mixer). Both are a mixer. Istio telemetry receives GRPC from sidecar containers and reports information about service interactions and parameters. Istio-policy accepts check requests to verify compliance with Policy rules. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://gqlxj1987.github.io/2019/09/23/automated-ML-hyperparameter-Tuning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gqlxj1987">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DevilKing's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/23/automated-ML-hyperparameter-Tuning/" class="post-title-link" itemprop="url">Automated ML Hyperparameter Tuning</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-23 15:21:47" itemprop="dateCreated datePublished" datetime="2019-09-23T15:21:47+08:00">2019-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-08 15:19:52" itemprop="dateModified" datetime="2022-01-08T15:19:52+08:00">2022-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ml/" itemprop="url" rel="index"><span itemprop="name">ml</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/automated-machine-learning-hyperparameter-tuning-in-python-dfda59b72f8a">原文链接</a></p>
<p>a complete example of Bayesian hyperparameter tuning of a gradient boosting machine using the <a target="_blank" rel="noopener" href="https://hyperopt.github.io/hyperopt/">Hyperopt library</a></p>
<h3 id="Bayesian-Optimization-Methods"><a href="#Bayesian-Optimization-Methods" class="headerlink" title="Bayesian Optimization Methods"></a>Bayesian Optimization Methods</h3><p>Bayesian methods differ from random or grid search in that they <em>use past evaluation results to choose the next values to evaluate</em>.</p>
<p><strong>limit expensive evaluations of the objective function by choosing the next input values based on those that have done well in the past</strong></p>
<h3 id="Four-Parts-of-Optimization-Problem"><a href="#Four-Parts-of-Optimization-Problem" class="headerlink" title="Four Parts of Optimization Problem"></a>Four Parts of Optimization Problem</h3><ol>
<li><strong>Objective Function:</strong> what we want to minimize, in this case the validation error of a machine learning model with respect to the hyperparameters</li>
<li><strong>Domain Space:</strong> hyperparametervalues to search over</li>
<li><strong>Optimization algorithm:</strong> method for constructing the surrogate model and choosing the next hyperparameter values to evaluate</li>
<li><strong>Result history:</strong> stored outcomes from evaluations of the objective function consisting of the hyperparameters and validation loss</li>
</ol>
<p>rather than separating training data into a distinct validation set, we use <a target="_blank" rel="noopener" href="https://machinelearningmastery.com/k-fold-cross-validation/">KFold cross validation</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">from</span> hyperopt <span class="keyword">import</span> STATUS_OK</span><br><span class="line"></span><br><span class="line">N_FOLDS = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the dataset</span></span><br><span class="line">train_set = lgb.Dataset(train_features, train_labels)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">objective</span>(<span class="params">params, n_folds = N_FOLDS</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Objective function for Gradient Boosting Machine Hyperparameter Tuning&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Perform n_fold cross validation with hyperparameters</span></span><br><span class="line">    <span class="comment"># Use early stopping and evalute based on ROC AUC</span></span><br><span class="line">    cv_results = lgb.cv(params, train_set, nfold = n_folds, num_boost_round = <span class="number">10000</span>, </span><br><span class="line">                        early_stopping_rounds = <span class="number">100</span>, metrics = <span class="string">&#x27;auc&#x27;</span>, seed = <span class="number">50</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Extract the best score</span></span><br><span class="line">    best_score = <span class="built_in">max</span>(cv_results[<span class="string">&#x27;auc-mean&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Loss must be minimized</span></span><br><span class="line">    loss = <span class="number">1</span> - best_score</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Dictionary with information for evaluation</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;loss&#x27;</span>: loss, <span class="string">&#x27;params&#x27;</span>: params, <span class="string">&#x27;status&#x27;</span>: STATUS_OK&#125;</span><br></pre></td></tr></table></figure>

<p>we are using <code>early_stopping_rounds</code>to stop the training when validation scores have not improved for 100 estimators</p>
<h3 id="Domain-Space"><a href="#Domain-Space" class="headerlink" title="Domain Space"></a>Domain Space</h3><p>In Bayesian optimization the idea is the same except this space has <em>probability distributions</em> for each hyperparameter rather than discrete values.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the search space</span></span><br><span class="line">space = &#123;</span><br><span class="line">    <span class="string">&#x27;class_weight&#x27;</span>: hp.choice(<span class="string">&#x27;class_weight&#x27;</span>, [<span class="literal">None</span>, <span class="string">&#x27;balanced&#x27;</span>]),</span><br><span class="line">    <span class="string">&#x27;boosting_type&#x27;</span>: hp.choice(<span class="string">&#x27;boosting_type&#x27;</span>, </span><br><span class="line">                               [&#123;<span class="string">&#x27;boosting_type&#x27;</span>: <span class="string">&#x27;gbdt&#x27;</span>, </span><br><span class="line">                                    <span class="string">&#x27;subsample&#x27;</span>: hp.uniform(<span class="string">&#x27;gdbt_subsample&#x27;</span>, <span class="number">0.5</span>, <span class="number">1</span>)&#125;, </span><br><span class="line">                                 &#123;<span class="string">&#x27;boosting_type&#x27;</span>: <span class="string">&#x27;dart&#x27;</span>, </span><br><span class="line">                                     <span class="string">&#x27;subsample&#x27;</span>: hp.uniform(<span class="string">&#x27;dart_subsample&#x27;</span>, <span class="number">0.5</span>, <span class="number">1</span>)&#125;,</span><br><span class="line">                                 &#123;<span class="string">&#x27;boosting_type&#x27;</span>: <span class="string">&#x27;goss&#x27;</span>&#125;]),</span><br><span class="line">    <span class="string">&#x27;num_leaves&#x27;</span>: hp.quniform(<span class="string">&#x27;num_leaves&#x27;</span>, <span class="number">30</span>, <span class="number">150</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&#x27;learning_rate&#x27;</span>: hp.loguniform(<span class="string">&#x27;learning_rate&#x27;</span>, np.log(<span class="number">0.01</span>), np.log(<span class="number">0.2</span>)),</span><br><span class="line">    <span class="string">&#x27;subsample_for_bin&#x27;</span>: hp.quniform(<span class="string">&#x27;subsample_for_bin&#x27;</span>, <span class="number">20000</span>, <span class="number">300000</span>, <span class="number">20000</span>),</span><br><span class="line">    <span class="string">&#x27;min_child_samples&#x27;</span>: hp.quniform(<span class="string">&#x27;min_child_samples&#x27;</span>, <span class="number">20</span>, <span class="number">500</span>, <span class="number">5</span>),</span><br><span class="line">    <span class="string">&#x27;reg_alpha&#x27;</span>: hp.uniform(<span class="string">&#x27;reg_alpha&#x27;</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),</span><br><span class="line">    <span class="string">&#x27;reg_lambda&#x27;</span>: hp.uniform(<span class="string">&#x27;reg_lambda&#x27;</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),</span><br><span class="line">    <span class="string">&#x27;colsample_bytree&#x27;</span>: hp.uniform(<span class="string">&#x27;colsample_by_tree&#x27;</span>, <span class="number">0.6</span>, <span class="number">1.0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>choice</code>: categorical variables</li>
<li><code>quniform</code>: discrete uniform (integers spaced evenly)</li>
<li><code>uniform</code>: continuous uniform (floats spaced evenly)</li>
<li><code>loguniform</code>: continuous log uniform (floats spaced evenly on a log scale)</li>
</ul>
<h3 id="Optimization-Algorithm"><a href="#Optimization-Algorithm" class="headerlink" title="Optimization Algorithm"></a>Optimization Algorithm</h3><p>use the <a target="_blank" rel="noopener" href="https://papers.nips.cc/paper/4443-algorithms-for-hyper-parameter-optimization.pdf">Tree Parzen Estimator</a></p>
<h3 id="Result-History"><a href="#Result-History" class="headerlink" title="Result History"></a>Result History</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/28/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><span class="page-number current">29</span><a class="page-number" href="/page/30/">30</a><span class="space">&hellip;</span><a class="page-number" href="/page/129/">129</a><a class="extend next" rel="next" href="/page/30/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">gqlxj1987</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">644</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">236</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">240</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">gqlxj1987</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
