<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.19"><title>Predictive CPU isolation in Netfix | Blog</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet"><style>:root{--primary: #2563eb;--text-main: #1f2937;--text-muted: #6b7280;--bg-main: #ffffff;--bg-secondary: #f9fafb;--border: #e5e7eb;--max-width: 800px;--font-sans: "Inter", system-ui, -apple-system, sans-serif;--font-mono: "JetBrains Mono", monospace}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);color:var(--text-main);background-color:var(--bg-main);line-height:1.6;-webkit-font-smoothing:antialiased}.app-container{display:flex;flex-direction:column;min-height:100vh}.navbar{border-bottom:1px solid var(--border);position:sticky;top:0;background:#fffc;backdrop-filter:blur(8px);z-index:100}.nav-content{max-width:var(--max-width);margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}.logo{text-decoration:none;color:var(--text-main);font-weight:800;font-size:1.5rem}.nav-links{list-style:none;display:flex;gap:1.5rem}.nav-links a{text-decoration:none;color:var(--text-muted);font-size:.95rem;font-weight:500;transition:color .2s}.nav-links a:hover{color:var(--primary)}.main-content{flex:1;max-width:var(--max-width);margin:0 auto;width:100%;padding:3rem 1rem}.footer{border-top:1px solid var(--border);background:var(--bg-secondary);padding:2rem 1rem;margin-top:4rem}.footer-content{max-width:var(--max-width);margin:0 auto;text-align:center;color:var(--text-muted);font-size:.9rem}.post-content h1,.post-content h2,.post-content h3{margin-top:2.5rem;margin-bottom:1rem;line-height:1.3}.post-content p{margin-bottom:1.5rem}.post-content img{max-width:100%;height:auto;border-radius:8px;margin:2rem 0}.post-content pre{border-radius:8px;padding:1.25rem;margin-bottom:2rem;font-family:var(--font-mono);font-size:.9rem;overflow-x:auto}.post-content code:not(pre code){background:var(--bg-secondary);padding:.2rem .4rem;border-radius:4px;font-family:var(--font-mono);font-size:.9em}.post-content blockquote{border-left:4px solid var(--primary);padding-left:1.5rem;font-style:italic;color:var(--text-muted);margin:2rem 0}.post-content ul,.post-content ol{margin-bottom:1.5rem;padding-left:1.5rem}.post-content li{margin-bottom:.5rem}
.post-header[data-astro-cid-rl3favg5]{margin-bottom:4rem;text-align:center}.post-date[data-astro-cid-rl3favg5]{display:block;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);font-weight:600;margin-bottom:1rem}.post-title[data-astro-cid-rl3favg5]{font-size:3rem;font-weight:800;line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.025em}.post-meta[data-astro-cid-rl3favg5]{display:flex;justify-content:center;gap:1.5rem;font-size:.95rem;color:var(--text-muted)}.tag[data-astro-cid-rl3favg5]{color:var(--primary);margin-right:.5rem}@media (max-width: 640px){.post-title[data-astro-cid-rl3favg5]{font-size:2rem}}
</style></head> <body> <div class="app-container"> <header class="navbar"> <div class="nav-content"> <a href="/" class="logo"> <span class="logo-text">Blog</span> </a> <nav> <ul class="nav-links"> <li><a href="/">Home</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/about">About</a></li> </ul> </nav> </div> </header> <main class="main-content">  <article class="post" data-astro-cid-rl3favg5> <header class="post-header" data-astro-cid-rl3favg5> <time class="post-date" data-astro-cid-rl3favg5> March 12, 2020 </time> <h1 class="post-title" data-astro-cid-rl3favg5>Predictive CPU isolation in Netfix</h1> <div class="post-meta" data-astro-cid-rl3favg5>  <div class="meta-item tags" data-astro-cid-rl3favg5> <span class="tag" data-astro-cid-rl3favg5>#docker</span> </div> </div> </header> <div class="post-content" data-astro-cid-rl3favg5> <p><a href="https://netflixtechblog.com/predictive-cpu-isolation-of-containers-at-netflix-91f014d856c7">原文链接</a></p>
<p>In Linux, the current mainstream solution is CFS (Completely Fair  Scheduler). Its goal is to assign running processes to time slices of  the CPU in a “fair” way.</p>
<p>Maintaining performance isolation between these different applications  is critical to ensuring a good experience for internal and external  customers.</p>
<p>What the OS task scheduler is doing is essentially solving a resource  allocation problem: I have X threads to run but only Y CPUs available,  how do I allocate the threads to the CPUs to give the illusion of  concurrency?</p>
<p>Resource allocation problems can be efficiently solved through a branch  of mathematics called combinatorial optimization, used for example for  airline scheduling or logistics problems.</p>
<ul>
<li>avoid spreading a container across multiple NUMA sockets (to avoid  potentially slow cross-sockets memory accesses or page migrations)</li>
<li>don’t use hyper-threads unless you need to (to reduce L1/L2 thrashing)</li>
<li>try to even out pressure on the L3 caches (based on potential measurements of the container’s hardware usage)</li>
<li>don’t shuffle things too much between placement decisions</li>
</ul>
<p>we define three events that trigger a placement optimization:</p>
<ul>
<li><strong>add</strong>: A new container was allocated by the Titus scheduler to this instance and needs to be run</li>
<li><strong>remove</strong>: A running container just finished</li>
<li><strong>rebalance</strong>: CPU usage may have changed in the containers so we should reevaluate our placement decisions</li>
</ul>
<p>Every time a placement event is triggered, <strong>titus-isolate</strong> queries a remote optimization service (running as a Titus service, hence also isolating itself… <a href="https://en.wikipedia.org/wiki/Turtles_all_the_way_down">turtles all the way down</a>) which solves the container-to-threads placement problem.</p>
<p>This service then queries a local <a href="https://en.wikipedia.org/wiki/Gradient_boosting">GBRT</a> model (retrained every couple of hours on weeks of data collected from  the whole Titus platform) predicting the P95 CPU usage of each container in the coming 10 minutes (conditional quantile regression).</p>
<p>The model contains both contextual features (metadata associated with  the container: who launched it, image, memory and network configuration, app name…) as well as time-series features extracted from the last hour of historical CPU usage of the container collected regularly by the  host from the kernel <a href="https://www.kernel.org/doc/Documentation/cgroup-v1/cpuacct.txt">CPU accounting controller</a>.</p> </div> </article>  </main> <footer class="footer"> <div class="footer-content"> <p>&copy; 2026 Liu Weifeng. Built with Astro.</p> </div> </footer> </div> </body></html> 